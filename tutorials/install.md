# Установка, настройка и первая программа

Иногда создаётся впечатление, что все существующие задачи могут быть решены с помощью готовых программ. Во многом это действительно так, но опыт показывает, что всегда находятся задачи, которые не решаются или плохо решаются стандартными средствами. В этих случаях приходится писать собственную программу, которая делает всё так, как ты этого хочешь.

Чтобы создавать программы на фрибейсике тебе понадобятся:

* компилятор FreeBASIC;
* средства сборки;
* редакторы кода.


## Компилятор

По умолчанию программы устанавливают в директорию программ `%ProgramFiles%`. Не будем отступать от этого правила.

### Для Windows x86

#### FreeBASIC на основе GCC 5.2.0

Эта стандартная сборка FreeBASIC.

[FreeBASIC-1.07.3-win32-gcc-5.2.0](http://downloads.sourceforge.net/fbc/FreeBASIC-1.07.3-win32.zip?download)

Если требуется компилировать с опцией `-gen gcc`, то дополнительно скачиваем и распаковывем в каталог с FreeBASIC:

[gcc-5.2.0-for-FB-win32](http://downloads.sourceforge.net/fbc/gcc-5.2.0-for-FB-win32-gengcc.zip?download)

#### FreeBASIC на основе GCC 8.1.0

Это экспериментальная сборка FreeBASIC, с ней исполняемые файлы получаются быстрее, однако стабильная работа не гарантируется.

[FreeBASIC-1.07.3-win32-gcc-8.1.0](http://downloads.sourceforge.net/fbc/FreeBASIC-1.07.3-win32-gcc-8.1.0.7z?download)

Если требуется компилировать с опцией `-gen gcc`, то дополнительно скачиваем и распаковывем в каталог с FreeBASIC:

[gcc-8.1.0-for-FB-win32](http://downloads.sourceforge.net/fbc/gcc-8.1.0-for-FB-win32-gengcc.zip?download)

### Для Windows x64

#### FreeBASIC на основе GCC 5.2.0

Эта стандартная сборка FreeBASIC.

[FreeBASIC-1.07.3-win64-gcc-5.2.0](http://downloads.sourceforge.net/fbc/FreeBASIC-1.07.3-win64.zip?download)

#### FreeBASIC на основе GCC 8.1.0

Это экспериментальная сборка FreeBASIC.

[FreeBASIC-1.07.3-win64-gcc-8.1.0](http://downloads.sourceforge.net/fbc/FreeBASIC-1.07.3-win64-gcc-8.1.0.7z?download)


## Средства сборки

В средства сборки входят библиотеки, отладчик GDB и набор утилит.

### Для Windows x86

[mingw-x86-5.2.0](http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win32/Personal%20Builds/mingw-builds/5.2.0/threads-win32/sjlj/i686-5.2.0-release-win32-sjlj-rt_v4-rev0.7z/download)

[mingw-x86-8.1.0](http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win32/Personal%20Builds/mingw-builds/8.1.0/threads-win32/sjlj/i686-8.1.0-release-win32-sjlj-rt_v6-rev0.7z/download)

### Для Windows x64

[mingw-64-5.2.0](http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/5.2.0/threads-win32/sjlj/x86_64-5.2.0-release-win32-sjlj-rt_v4-rev0.7z/download)

[mingw-64-8.1.0](http://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/8.1.0/threads-win32/sjlj/x86_64-8.1.0-release-win32-sjlj-rt_v6-rev0.7z/download)


## Редакторы кода

Компилятор фрибейсика — это программа только для компиляции исходного кода. предполагается, что исходный код программы будет создан в стороннем редаторе исходного кода или среде разработки, которые в поставку с компилятором не идут. Поэтому придётся самому выбирать и настраивать удобную для себя среду.

С одной стороны это отпугивает новичков, привыкших к таким средам разработки как QBASIC или Visual Studio. С другой стороны, отсутствует привязка программиста к конкретной среде или редактору, исходный код можно писать в том, что привычно и удобно.

### Блокнот

В эту категорию отнесём обычный «Блокнот» и всё, чем можно открыть текстовый файл и исправить его на скорую руку.

### Notepad++

Блокнот с подсветкой ключевых слов и некоторых встроенных функций и автоматической расстановкой отступов.

[Домашная страница Notepad++](https://notepad-plus-plus.org/)

### WinFBE

Хорошая среда разработки с подсветкой синтаксиса, отступами и всплывающими подсказками по функциям. Компилировать программы можно прямо из редактора, достаточно в настройках указать путь к компилятору.

[Домашная страница WinFBE](https://github.com/PaulSquires/WinFBE)

### FBEdit

Полноценная среда разработки, позволяет редактировать шаблоны оконных приложений мышкой.


## Как работает FreeBASIC

FreeBASIC — это модульный компилятор, где компиляция разделена на две части: так называемые front-end (собственно FreeBASIC) и back-end:

* Front-end переводит исходный код программы не в машинный код конкретной платформы, а в некое промежуточное представление, соответствующее логике программы и не зависящее от языка и платформы;
* Back-end преобразует промежуточное представление кода в машинный код конкретной платформы.

Почему же не сделать всё за один шаг? Такой ступенчатый процесс имеет преимущества: нет нужды делать компилятор полностью для каждой новой платформы, можно оставить front-end неизменным (он отвечает за синтаксис языка) и написать только новый back-end. Более того, FreeBASIC не использует собственную разработку back-end, но полагается на известные решения. В качестве такого известного решения FreeBASIC использует Gnu Compiler Collection (GCC) и Low Level Virtual Machine (LLVM).

### Компиляция (трансляция)

Перевод текста программы в код промежуточного представления для Back-end. По умолчанию в роли Back-end выступает GCC, и FreeBASIC генерирует промежуточное представление кода на языке Си.

### Трансляция в ассемблер

Back-end транслирует сгенерированный код в ассемблерный код.

На 32‐битной системе фрибейсик по умолчанию создаёт ассемблерный код непосредственно, без компиляции в промежуточное представление.

### Ассемблирование

Программа‐ассемблер из ассемблерного кода создаёт объектные файлы.

### Линковка

Компоновщик связывает все сгенерированные объектные файлы и код функций из статических библиотек в один исполняемый файл.

### Очистка

Фрибейсик удаляет временные файлы.


## Пакет компилятора

После того, как ты распаковал или установил FreeBASIC, ты можешь увидеть следующую структуру папок:

```
FreeBASIC
│
├───bin — утилиты для компиляции
│   │
│   ├───libexec — вспомогательные утилиты для GCC
│   │   │
│   │   └───…
│   │
│   └──win32 или win64
│       │
│       ├───ar.exe — архиватор объектных файлов в статические библиотеки функций
│       │
│       ├───as.exe — ассемблер
│       │
│       ├───dlltool.exe — утилита для создания библиотек импорта
│       │
│       ├───gdb.exe — отладчик
│       │
│       ├───gcc.exe — back-end GCC
│       │
│       ├───GoRC.exe — компилятор ресурсов
│       │
│       ├───gprof.exe — профилировщик
│       │
│       └───ld.exe — компоновщик
│
├───examples — примеры программ
│   │
│   └───…
│
├───inc — заголовочные файлы для библиотек
│   │
│   └───…
│
├───lib — статические библиотеки с функциями
│   │
│   └───…
│
├───changelog.txt — список изменений по сравнению с предыдущей версией компилятора
│
└───fbc.exe — собственно компилятор фрибейсика
```


## Первая программа

### Расширения файлов

Файлы исходного кода — это обычные текстовые файлы со следующими расширениями:

* .bas — собственно исходный код с функциями;
* .bi — заголовочные файлы с объявлением структур и функций;
* .rc — скрипт с описаниями ресурсов для WinAPI.

Тебе также могут встретиться файлы со следующими расширениями:

* .a — статически подключаемая библиотека функций;
* .dll — динамически подключаемая библиотека функций;
* .o — объектный файл;
* .obj — объектный файл;
* .res — скомпилированный файл ресурсов.

### Из чего состоят файлы исходного кода фрибейсика

Любой язык программирования состоит из лексем — последовательности допустимых символов языка, имеющих значение. Лексемы подразделяются на ключевые слова, операторы, идентификаторы, комментарии и всё такое прочее.

Ключевые слова имеют непосредственное отношение к языку. Примеры: `Dim`, `ByRef`, `Function`, `Integer`, `Type`, `Alias`, `As`. Когда ключевые слова собираются вместе, то образуются выражения.

Выражения — это одно или несколько ключевых слов, задающие последовательность действий. Примеры выражений:

```FreeBASIC
' Объявление функции
Declare Function Minimum(ByVal a As Integer, ByVal b As Integer)As Integer

' Объявление переменной
Dim Name As WString * 256

' Оператор сложения
x + y
```

Каждое выражение обычно располагают на отдельной строке. Так удобнее читать код.

### Простейшая программа

Простейший файл исходного кода — это пустой текстовый файл с расширением `.bas`, его можно скомпилировать и получить полноценную программу. Такая программа ничего не делает и сразу же завершается после запуска:

```FreeBASIC


```

### Вывод текста на экран

Напишем теперь программу, которая будет делать хоть что-нибудь. Например, выводить на консоль фразу «Всем привет!»:

```FreeBASIC
Print "Всем привет!"
```

Для отображения текста на экране используется функция `Print`. Сейчас функция принимает единственный аргумент — строку в кавычках, которую она выводит на консоль.


## Компиляция

Создадим специальную директорию для исходных кодов «C:\\Programming\\FreeBASIC Projects», в ней подкаталог «HelloWorld». Открой текстовый редактор, например блокнот или Nodepad++, и сохрани текст программы в файле «HelloWorld.bas».

### Компиляция «перетаскиванием мышью»

Для простых консольных программ достаточно перетащить мышью значок файла «HelloWorld.bas» на компилятор. Перетаскивание мышью запускает программу, в данном случае «fbc.exe», и передаёт ей параметром название перетаскиваемого файла. Компилятор FreeBASIC получает имя файла, запускает процесс компиляции и сохраняет готовую программу рядом с исходным файлом.

### Компиляция вручную

Открой «Пуск» → «Выполнить», запусти интерпретатор команд <kbd>cmd.exe</kbd> и перейди в каталог, куда установлен компилятор, например, так:

<pre class="console"><samp><span class="promt">C:\Users\Пользователь&gt;</span><kbd>cd %programfiles%\freebasic</kbd>

<span class="promt">C:\Program Files\FreeBASIC&gt;</span><span class="cursor">_</span>
</samp></pre>

Теперь можно запускать компилятор и получать исполняемый файл такой командой:

<pre class="console"><samp><span class="promt">C:\Program Files\FreeBASIC&gt;</span><kbd>fbc "C:\Programming\FreeBASIC Projects\HelloWorld.bas"</kbd>
</samp></pre>

### Компиляция через пакетный файл

Создай пакетный файл «compile.cmd» следующего содержания:

```Batchfile
"%ProgramFiles%\FreeBASIC\fbc.exe" HelloWorld.bas
```

### Компиляция из среды разработки на примере WinFBE

Если ты прописал в WinFBE путь к каталогу с компилятором, то достаточно в меню «Компилировать» выбрать пункт «Собрать и выполнить» или нажать клавишу F5.

### Компиляция утилитой make

Утилита `make` создана для инкрементальной сборки программ. Этот вариат незаменим для больших проектов.

[Как использовать утилиту make](/articles/utilities-gnumake.htm)


## Запуск программы

Теперь у тебя есть своя первая настоящая программа «HelloWorld.exe»:

<pre class="console"><samp><span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><kbd>HelloWorld.exe</kbd>
Привет, мир!

<span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><span class="cursor">_</span>
</samp></pre>

### Остановим выполнение

Если запускать рассмотренную выше программу из проводника, то обнаружится, что она выводит строку и сразу же завершается («как будто что‐то мелькнуло на экране»), не дав нам разглядеть результат. Бороться с этим можно двумя способами.

#### Пауза после компиляции

Измени пакетный файл «compile.cmd» так:

```Batchfile
"%ProgramFiles%\FreeBASIC\fbc.exe" HelloWorld.bas
HelloWorld.exe
pause
```

#### Пауза в программе

Второй способ — это сказать компьютеру, что в конце работы надо дождаться нажатия какой‐нибудь клавиши.

```FreeBASIC
REM Выводим строку «Здравствуй, мир!»
Print "Здравствуй, мир!"

' Ждём нажатия любой клавиши
Sleep()
/'
    Конец программы
'/
```


## Разбор программы

Теперь программа длиннее и состоит из восьми строк.

Появилось непонятное слово `REM`. Это ключевое слово обозначает начало комментария. Всё, что будет написано после слова `REM` и до конца строки компилятор будет игнорировать. Также комментарием является всё, что идёт после символа `'`. Ключевое слово `REM` и лексема `'` равнозначны. Многострочные комментарии начинаются с символов `/'` и заканчиваются символами `'/`. На текст внутри этого блока («Конец программы») компилятор не будет обращать внимания. Комментарии никак не влияют на работу программы, они нужны программистам, чтобы лучше понимать код.

В пятой строке появился вызов функции `Sleep()`. Эта функция останавливает поток программы и ждёт нажатия любой клавиши.

### Функция Print

Теперь давай подробнее изучим функцию `Print` для вывода данных на консоль. Эта функция находится в библиотеке времени выполнения, компилятор автоматически добавит код вызова функции в исполняемый файл.

Функция `Print` принимает несколько аргументов и выводит их на консоль. Аргументы должны быть разделены запятыми `,` точками с запятой `;` или их сочетанием:

* разделитель «точка с запятой» заставляет выводить аргументы без пробелов между ними;
* разделитель «запятая» заставляет выводить аргументы по позициям табуляции;
* чтобы вывести текст без переноса строки, нужно в конце добавить точку с запятой.


## Примеры

Создадим несколько программ «PrintSomeWords.exe», печатающих фразы с разными разделителями.

### Вывод текста без разделителей

```FreeBASIC
' Печатаем несколько фраз без разделителей
Print "Эта"; "фраза"; "будет показана"; "без разделителей"
```

Результат работы программы:

<pre class="console"><samp><span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><kbd>PrintSomeWords.exe</kbd>
Этафразабудет показанабез разделителей

<span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><span class="cursor">_</span>
</samp></pre>

### Вывод текста по позициям табуляции

```FreeBASIC
' Печатаем несколько слов по позициям табуляции
Print "Фраза", "через табуляции"
```

Результат работы программы:

<pre class="console"><samp><span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><kbd>PrintSomeWords.exe</kbd>
Фраза	через табуляции

<span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><span class="cursor">_</span>
</samp></pre>

### Вывод текста по позициям табуляции и без разделителей

```FreeBASIC
' Совмещаем вывод с запятой и точкой с запятой
Print "Фраза", "через"; "разные разделители"
```

Результат работы программы:

<pre class="console"><samp><span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><kbd>PrintSomeWords.exe</kbd>
Фраза	черезразные разделители

<span class="promt">C:\Programming\FreeBASIC Projects&gt;</span><span class="cursor">_</span>
</samp></pre>

### Вывод пустой строки

Для того, чтобы вывести пустую строку, достаточно использовать `Print` без всяких аргументов.
